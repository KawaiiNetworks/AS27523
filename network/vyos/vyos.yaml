local-asn: 27523

as-set:
  member-limit: 250
  prefix-limit: 100
  limit-violation: accept # accept, deny

router:
  - name: core.mci.atlas.projectk.org
    src:
      ipv4: 23.175.184.1
      ipv6: 2602:f93b:131::1
    service:
      bmp:
        - target: akvorado
          mirror: false
          address: 192.168.32.200
          port: 10179
      sflow:
        agent-address: 192.168.32.1
        interface: [eth0, eth1.200, eth2, eth3.2, eth3.3, br5, tun10]
        server:
          - address: 192.168.32.200
            port: 6343
          - address: 162.159.65.1
            port: 6343
      snmp:
        listen-address: 192.168.32.1
        location: MCI
        encrypted-password: ed3cd22e4f7e4fb5ae5438fc5bce2ba735d4a950
    policy:
      prefix-list6:
        - name: AUTOGEN-BACKBONE-TunnelEndpoint
          rule:
            - action: permit
              prefix: 2602:f93b:f31::/48
        - name: AUTOGEN-DNA-GOOGLE
          rule:
            - action: permit
              prefix: 2602:f93b:131::/48
        - name: AUTOGEN-Tunnel-Endpoints
          rule:
            - action: permit
              prefix: 2403:ad80:88:44fd::9c38/128
              le: 128
      as-path-list:
        - name: AUTOGEN-AS7018
          rule:
            - action: permit
              regex: _7018_
        - name: AUTOGEN-AS1299
          rule:
            - action: permit
              regex: _1299_
        - name: AUTOGEN-AS174
          rule:
            - action: permit
              regex: _174_
    redistribute:
      - action: permit
        match: ipv6 address prefix-list AUTOGEN-BACKBONE-TunnelEndpoint
        set: large-community add 27523:1101:1972
      - action: permit
        match: ipv6 address prefix-list AUTOGEN-DNA-GOOGLE
        set: large-community add 27523:1000:15169
    protocols:
      rpki:
        - server: 192.168.32.2
          port: 8082
          preference: 10
      bgp:
        ibgp:
          - description: BGP Tunnel to TYO
            neighbor-address: 169.254.20.5
            simple-out: true
            local-pref: 180
            update-source: tun20
          - description: BGP Tunnel to TYO
            neighbor-address: 2602:f93b:ffff:ffff:5:1:0:1
            simple-out: true
            local-pref: 180
            pre-import-accept:
              - action: deny
                match: ipv6 address prefix-list AUTOGEN-Tunnel-Endpoints
            update-source: tun20
        upstream:
          - asn: 945
            prepend: "27523"
            neighbor-address: 206.51.7.160
            update-source: eth2
            pre-export-accept:
              - action: permit
                set: "community add '945:30049'"
            pre-import-accept:
              - action: deny
                match: as-path AUTOGEN-AS7018
              - action: deny
                match: as-path AUTOGEN-AS1299
              - action: deny
                match: as-path AUTOGEN-AS174
          - asn: 945
            neighbor-address: 2001:504:1b:1::160
            local-pref: 99
            update-source: eth2
            pre-export-accept:
              - action: deny
            pre-import-accept:
              - action: deny
          - asn: 6939
            description: HE KCIX Upstream
            # example
            # prepend: "27523 27523 27523"
            # pre-import-accept:
            #   - action: permit
            #     match: ipv6 address prefix-list AUTOGEN-CERNET-0
            #     set: "local-preference '500'"
            neighbor-address: 2001:504:1b:1::5
            update-source: eth2
          - asn: 6939
            description: HE SIX Upstream
            prepend: "27523"
            neighbor-address: 2001:504:16::1b1b
            metric: "+10"
            update-source: eth3.2
          - asn: 6939
            description: HE SIX Jumbo Upstream
            neighbor-address: 2001:504:16:1::1b1b
            metric: "+5"
            update-source: eth3.3
          - asn: 13737
            neighbor-address: 74.80.181.233
            update-source: eth0
          - asn: 13737
            neighbor-address: 2620:11f:700f:1::8
            update-source: eth0
        routeserver:
          - asn: 33108
            description: SIX IPv4 RS
            neighbor-address:
              - 206.81.80.2
              - 206.81.80.3
            metric: "+10"
            update-source: eth3.2
          - asn: 33108
            description: SIX IPv6 RS
            neighbor-address:
              - 2001:504:16::2
              - 2001:504:16::3
            metric: "+10"
            update-source: eth3.2
          - asn: 33108
            description: SIX Jumbo IPv4 RS
            neighbor-address:
              - 206.81.82.2
              - 206.81.82.3
              - 149.112.96.2
              - 149.112.96.3
            metric: "+5"
            update-source: eth3.3
          - asn: 33108
            description: SIX Jumbo IPv6 RS2
            neighbor-address:
              - 2001:504:16:1::2
              - 2001:504:16:1::3
            metric: "+5"
            update-source: eth3.3
          - asn: 40542
            description: KCIX IPv4 RS
            neighbor-address: 206.51.7.126
            update-source: eth2
          - asn: 40542
            description: KCIX IPv6 RS
            neighbor-address: 2001:504:1b:1::126
            update-source: eth2
          - asn: 40115
            description: Pigeon IX MCI RS
            neighbor-address: 2602:f9f6:7e0:5::1
            local-pref: 125
            update-source: br5
        peer:
          - asn: 714
            description: Apple SIX
            neighbor-address:
              - 206.81.80.204
              - 206.81.80.205
              - 2001:504:16::205:0:2ca
              - 2001:504:16::2ca
            update-source: eth3.2
          - asn: 1828
            description: Unitas Global KCIX
            neighbor-address:
              - 206.51.7.54
              - 2001:504:1b:1::54
            update-source: eth2
          - asn: 1828
            description: Unitas Global SIX
            neighbor-address:
              - 206.81.80.36
              - 2001:504:16::724
            metric: "+5"
            update-source: eth3.2
          - asn: 6456
            neighbor-address:
              - 206.81.80.10
              - 206.81.81.41
              - 2001:504:16::1938
              - 2001:504:16::297:0:1938
            update-source: eth3.2
          - asn: 6939
            neighbor-address: 206.81.80.40
            metric: "+5"
            update-source: eth3.2
          - asn: 6939
            neighbor-address:
              - 206.81.82.40
              - 149.112.96.40
            metric: "+10"
            update-source: eth3.3
          - asn: 6939
            neighbor-address: 206.51.7.5
            update-source: eth2
          - asn: 13150
            neighbor-address: 206.81.81.46
            update-source: eth3.2
          - asn: 13335
            neighbor-address:
              - 206.51.7.34
              - 2001:504:1b:1::34
            update-source: eth2
          - asn: 13335
            description: Cloudflare SIX
            neighbor-address:
              - 206.81.81.10
              - 206.81.81.58
              - 2001:504:16::3417
              - 2001:504:16::314:0:3417
            metric: "+5"
            update-source: eth3.2
          - asn: 15169
            description: Google SIX
            neighbor-address:
              - 206.81.80.17
              - 2001:504:16::3b41
            metric: "+5"
            password: jutran7dEbUwr6c9
            update-source: eth3.2
            pre-import-accept:
              - action: deny
                match: as-path AUTOGEN-AS-ALL
          - asn: 15169
            description: Google SIX
            neighbor-address:
              - 206.81.80.69
              - 2001:504:16::69:0:3b41
            password: jutran7dEbUwr6c9
            update-source: eth3.2
            pre-import-accept:
              - action: deny
                match: as-path AUTOGEN-AS-ALL
          - asn: 16509
            description: Amazon KCIX
            neighbor-address:
              - 206.51.7.131
              - 206.51.7.194
              - 2001:504:1b:1::131
              - 2001:504:1b:1::194
            update-source: eth2
          - asn: 16509
            description: Amazon SIX
            metric: "+10"
            neighbor-address:
              - 206.81.80.147
              - 206.81.80.248
              - 206.81.80.249
              - 206.81.80.250
              - 2001:504:16::407d
              - 2001:504:16::248:0:407d
              - 2001:504:16::249:0:407d
              - 2001:504:16::250:0:407d
            update-source: eth3.2
          - asn: 25668
            neighbor-address:
              - 206.81.80.103
              - 2001:504:16::6444
            update-source: eth3.2
          - asn: 44324
            passive: true
            neighbor-address:
              - 206.51.7.208
              - 2001:504:1b:1::208
            update-source: eth2
          - asn: 49544
            description: i3D SIX
            neighbor-address:
              - 206.81.80.117
              - 2001:504:16::c188
            update-source: eth3.2
        downstream:
          - asn: 55223
            passive: true
            neighbor-address: 2602:f93b:131:ffff::5:5223:1
            update-source: eth6
          - asn: 140915
            passive: true
            neighbor-address: 2602:f93b:131:ffff::14:915:1
            update-source: eth6
          - asn: 203023
            passive: true
            neighbor-address: 2602:f93b:131:ffff::20:3023:1
            update-source: eth6
          - asn: 208223
            passive: true
            neighbor-address: 2602:f93b:131:ffff::20:8223:1
            update-source: eth6
          - asn: 215750
            passive: true
            neighbor-address: 2602:f93b:131:ffff::21:5750:1
            update-source: eth6
          - asn: 216299
            passive: true
            neighbor-address: 2602:f93b:131:ffff::21:6299:1
            update-source: eth6
          - asn: 401009
            passive: true
            neighbor-address: 2602:f93b:ffff:131::40:1009:1
            update-source: eth6
          - asn: 212232
            description: BGP Tools
            neighbor-address: 2a0c:2f07:9459::b12
            update-source: 2602:f93b:131::1
            multihop: 255

  - name: core.tyo.atlas.projectk.org
    src:
      ipv4: 103.27.185.43
      ipv6: 2602:f93b:151::1
    service:
      bmp:
        - target: akvorado
          mirror: false
          address: 2602:f93b:131:32::200
          port: 10179
      sflow:
        agent-address: 2602:f93b:151::1
        interface: [eth0]
        server:
          - address: 2602:f93b:131:32::200
            port: 6343
          - address: 162.159.65.1
            port: 6343
      snmp:
        listen-address: 2602:f93b:151::1
        location: TYO
        encrypted-password: a2bf3a51b0a6021cc33bb2606aec5c8d95de642a
    policy:
      prefix-list6:
        - name: AUTOGEN-Tunnel-Endpoints
          rule:
            - action: permit
              prefix: 2602:f93b:131::1/128
              le: 128
      as-path-list:
        - name: AUTOGEN-AS-PassGFW
          rule:
            - action: permit
              description: Edgecast
              regex: "15133$"
            - action: permit
              description: Fastly
              regex: "54113$"
            - action: permit
              description: Google
              regex: "(15169|16550|16591|19527|36040|43515|139070|139190|396982)$"
            - action: permit
              description: Telegram
              regex: "(62014|62041|59930)$"
            - action: permit
              description: Twitter
              regex: "(13414|35995|63179)$"
            - action: permit
              description: Cloudflare
              regex: "13335$"
            - action: permit
              description: IDC Frontier
              regex: "4694$"
            - action: permit
              description: Amazon for docker
              regex: "(14618|16509)$"
    # custom-config: |
    #   delete policy prefix-list6 AUTOGEN-Tunnel-Endpoints
    #   set policy prefix-list6 AUTOGEN-Tunnel-Endpoints rule 10 action permit
    #   set policy prefix-list6 AUTOGEN-Tunnel-Endpoints rule 10 prefix 2602:f93b:131::1/128
    #   set policy prefix-list6 AUTOGEN-Tunnel-Endpoints rule 10 le 128
    protocols:
      rpki:
        - server: rtr.rpki.cloudflare.com
          port: 8282
          preference: 10
      bgp:
        ibgp:
          - description: BGP Tunnel to MCI
            neighbor-address: 169.254.20.6
            simple-out: true
            update-source: tun20
            pre-export-accept:
              - action: deny
                match: as-path AUTOGEN-AS-CERNET
              - action: deny
                match: as-path AUTOGEN-AS-Except-China
          - description: BGP Tunnel to MCI
            neighbor-address: 2602:f93b:ffff:ffff:3:1:0:1
            update-source: tun20
            simple-out: true
            pre-import-accept:
              - action: deny
                match: as-path AUTOGEN-AS-CERNET
              - action: deny
                match: ipv6 address prefix-list AUTOGEN-Tunnel-Endpoints
          - description: BGP Tunnel to Home
            neighbor-address: 169.254.11.2
            update-source: wg1151
            pre-export-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
                match: as-path AUTOGEN-AS-ALL
          - description: BGP Tunnel to Home
            neighbor-address: 2602:f93b:151:ffff::2
            update-source: wg1151
            pre-export-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
                match: as-path AUTOGEN-AS-ALL
        upstream:
          - asn: 134835
            neighbor-address: 10.1.52.253
            update-source: 103.27.185.43
            multihop: 2
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
                match: as-path AUTOGEN-AS-Except-China
          - asn: 134835
            neighbor-address: 2403:ad80:8f:ffff::253
            update-source: 2403:ad80:88:44fd::9c38
            multihop: 2
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
                match: as-path AUTOGEN-AS-Except-China
        routeserver: []
        peer: []
        downstream:
          - asn: 212232
            description: BGP Tools
            neighbor-address: 2a0c:2f07:9459::b9
            update-source: 2602:f93b:151::1
            multihop: 255

  - name: edge.zj.atlas.projectk.org
    protocols:
      rpki:
        - server: rtr.rpki.cloudflare.com
          port: 8282
          preference: 10
      bgp:
        ibgp:
          - description: BGP Tunnel to Tokyo
            neighbor-address: 169.254.11.1
            update-source: wg1151
            simple-out: true
          - description: BGP Tunnel to Tokyo
            neighbor-address: 2602:f93b:151:ffff::1
            update-source: wg1151
            simple-out: true
        upstream: []
        routeserver: []
        peer: []
        downstream: []

  - name: core.hk.atlas.projectk.org
    src:
      ipv4: 45.148.132.153
      ipv6: 2602:f93b:121::1
    protocols:
      rpki:
        - server: rtr.rpki.cloudflare.com
          port: 8282
          preference: 10
      bgp:
        ibgp: []
        upstream:
          - asn: 955
            description: LSHIY Upstream
            multihop: 255
            neighbor-address: 103.203.242.1
            update-source: eth0
            soft-reconfiguration-inbound: false
            pre-import-accept:
              - action: deny
                match: as-path AUTOGEN-AS-ALL
          - asn: 955
            description: LSHIY Upstream
            multihop: 255
            neighbor-address: 2401:4020:1:1::1
            update-source: eth0
            pre-import-accept:
              - action: deny
                match: as-path AUTOGEN-AS-ALL
        routeserver: []
        peer: []
        downstream: []

  - name: core.tpe.atlas.projectk.org
    src:
      ipv4: 103.147.22.125
      ipv6: 2602:f93b:141::1
    service:
      bmp:
        - target: akvorado
          mirror: false
          address: 2602:f93b:131:32::200
          port: 10179
      sflow:
        agent-address: 2602:f93b:141::1
        interface: [eth1, wg10001]
        server:
          - address: 2602:f93b:131:32::200
            port: 6343
          - address: 162.159.65.1
            port: 6343
      snmp:
        listen-address: 2602:f93b:141::1
        location: TPE
        encrypted-password: a4ab5a99dfdfdb23d925bdc74b59ba103789c2aa
    policy:
      prefix-list6:
        - name: AUTOGEN-BACKBONE-TunnelEndpoint
          rule:
            - action: permit
              prefix: 2602:f93b:f41::/48
      as-path-list:
        - name: AUTOGEN-AS-PassGFW
          rule:
            - action: permit
              description: Edgecast
              regex: "15133$"
            - action: permit
              description: Fastly
              regex: "54113$"
            - action: permit
              description: Google
              regex: "(15169|16550|16591|19527|36040|43515|139070|139190|396982)$"
            - action: permit
              description: Telegram
              regex: "(62014|62041|59930)$"
            - action: permit
              description: Twitter
              regex: "(13414|35995|63179)$"
            - action: permit
              description: Cloudflare
              regex: "13335$"
            - action: permit
              description: IDC Frontier
              regex: "4694$"
            - action: permit
              description: Amazon for docker
              regex: "(14618|16509)$"
    redistribute:
      - action: permit
        match: ipv6 address prefix-list AUTOGEN-BACKBONE-TunnelEndpoint
        set: large-community add 27523:1101:21167
    protocols:
      rpki:
        - server: rtr.rpki.cloudflare.com
          port: 8282
          preference: 10
      bgp:
        ibgp: []
        upstream:
          - asn: 6939
            description: HE Upstream
            neighbor-address: 2a0f:5707:ffe3::30
            soft-reconfiguration-inbound: false
            update-source: eth1
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
                match: as-path AUTOGEN-AS-ALL
          - asn: 18041
            neighbor-address:
        routeserver:
          - asn: 38855
            description: STUIX IPv4 RS
            neighbor-address:
              - 103.158.187.1
              - 103.158.187.2
            update-source: eth1
            soft-reconfiguration-inbound: false
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
                match: as-path AUTOGEN-AS-Tier1
          - asn: 38855
            description: STUIX IPv6 RS
            soft-reconfiguration-inbound: false
            neighbor-address:
              - 2a0f:5707:ffe3::1
              - 2a0f:5707:ffe3::2
            update-source: eth1
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
                match: as-path AUTOGEN-AS-Tier1
        peer:
          - asn: 6939
            description: HE Peer
            neighbor-address: 103.158.187.30
            update-source: eth1
            soft-reconfiguration-inbound: false
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
                match: as-path AUTOGEN-AS-ALL
          - asn: 13335
            neighbor-address:
              - 103.158.187.34
              - 2a0f:5707:ffe3::34
            update-source: eth1
          - asn: 16509
            neighbor-address:
              - 103.158.187.36
              - 103.158.187.45
              - 2a0f:5707:ffe3::36
              - 2a0f:5707:ffe3::45
            update-source: eth1
        downstream:
          - asn: 203023
            passive: true
            neighbor-address:
              - 169.254.12.1
              - 2602:f93b:ffff:ffff:1:2:0:1
            update-source: wg1241

  - name: core.fra.atlas.projectk.org
    src:
      ipv4: 179.61.138.168
      ipv6: 2602:f93b:161::1
    service:
      bmp:
        - target: akvorado
          mirror: false
          address: 2602:f93b:131:32::200
          port: 10179
      sflow:
        agent-address: 2602:f93b:161::1
        interface: [eth0, eth1, eth2]
        server:
          - address: 2602:f93b:131:32::200
            port: 6343
          - address: 162.159.65.1
            port: 6343
      snmp:
        listen-address: 2602:f93b:161::1
        location: FRA
        encrypted-password: a4a5bb9f81f9ecb16e33d22e173c414c3c384f63
    protocols:
      rpki:
        - server: rtr.rpki.cloudflare.com
          port: 8282
          preference: 10
      bgp:
        ibgp: []
        upstream:
          - asn: 6939
            neighbor-address: 2001:7f8:f2:e1::6939:1
            update-source: eth1
        routeserver:
          - asn: 202409
            neighbor-address:
              - 185.1.166.100
              - 185.1.166.200
              - 185.1.166.254
            update-source: eth1
          - asn: 202409
            neighbor-address:
              - 2001:7f8:f2:e1::babe:1
              - 2001:7f8:f2:e1::dead:1
              - 2001:7f8:f2:e1::be5a
            update-source: eth1
        peer:
          - asn: 6939
            neighbor-address: 185.1.167.69
            update-source: eth1
          - asn: 13335
            neighbor-address:
              - 185.1.166.3
              - 2001:7f8:f2:e1:0:1:3335:1
            update-source: eth1
          - asn: 200078
            neighbor-address: 2001:7f8:f2:e1:0:2000:78:1
            update-source: eth1
        downstream: []
